---
globs: *.tsx
alwaysApply: false
---
# Translations (Lingui)

This project uses Lingui for i18n with dynamic catalog loading.

## Daily workflow

- Add messages in code using Lingui macros

- JSX UI text: `import { Trans } from '@lingui/react/macro'` → `<Trans>Forgot Password</Trans>`
- Strings (validators, toasts, helpers): `import { t } from '@lingui/core/macro'` → `t`Email is required``
- In arrays/loops, build descriptors with `msg` and render with `useLingui()._` when needed

- Extract messages

```bash
bun run lingui:extract
```

- Translate catalogs

- Edit `src/locales/de/messages.po` (and other locales) and fill missing `msgstr`

- Compile catalogs

```bash
bun run lingui:compile
```

## Runtime

- `src/i18n.ts` exposes `loadCatalog(locale)` which dynamically imports `src/locales/{locale}/messages.po` and calls `i18n.loadAndActivate`
- `src/main.tsx` invokes `loadCatalog` on app start (and on locale changes)

## Patterns

- Prefer `Trans` for JSX text
- Prefer `t` for non-JSX strings (forms, zod, toasts)
- If translation is needed inside initialization code, create it inside the component (e.g., `useMemo`) so it runs after locale activation

## Troubleshooting

- Error: “Attempted to call a translation function without setting a locale”
  - Ensure `loadCatalog(locale)` ran before using `t`/`Trans`
  - Do not call translation macros at module scope if locale may not yet be activated
- Type issues for generated catalogs
  - Ensure `.po` import path matches `lingui.config.ts`
  - Re-run extract/compile and restart the dev server
